import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config();

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

const gdiDiagnosticArticles = [
  {
    title: "Pruebas de Inyectores GDI - Procedimiento Completo Paso a Paso",
    keywords: ["prueba inyector gdi", "diagnóstico inyector", "test inyector", "inyección directa", "procedimiento"],
    answer: "[PRUEBAS INYECTOR GDI - LISTA COMPLETA]\n\n1. PRUEBA VISUAL (Desconectar inyector)\n   - Inspeccionar esfera/punta del inyector\n   - Debe estar LIMPIA y plateada\n   - Si está NEGRA o con depósitos = inyector defectuoso\n   - Si está ROJA o carbón pegado = combustible sucio\n   - Revisar conector eléctrico: Debe estar seco\n   - Si mojado = agua/combustible filtrando\n\n2. PRUEBA RESISTENCIA BOBINA (Multímetro Ohmetro)\n   - Inyector GDI típico: 2-4 ohms\n   - Si <0.5 ohms = bobina en cortocircuito, DEFECTUOSO\n   - Si >10 ohms = bobina abierta, DEFECTUOSO\n   - Si muestra \"1\" (infinito) = circuito abierto, DEFECTUOSO\n   - Medir entre los 2 bornes del conector\n   - NOTA: Resistencia debe ser ESTABLE (no varía)\n\n3. PRUEBA DE VOLTAJE (Motor Encendido)\n   Conectar multímetro en voltios DC paralelo:\n   - Terminal positiva: A pin positivo del conector\n   - Terminal negativa: A masa del motor\n   - Voltaje debe ser: 12V ±0.5V en reposo\n   - Si <10V: Revisar cableado y relé\n   - Si 0V: Fusible o relé defectuoso\n\n4. PRUEBA PULSO INYECCIÓN (Multímetro Amperímetro)\n   Conectar en serie con negativo inyector:\n   - Motor ralentí: Debe ver picos de corriente\n   - Picos deben ser: 2-4 Amperios cada 0.1-0.2 seg\n   - Amplitud debe ser CONSISTENTE (no varía)\n   - Si amplitud varía: Solenoide parcialmente defectuoso\n   - Si NO hay picos: Inyector defectuoso o conector suelto\n\n5. PRUEBA CON OSCILOSCOPIO (Herramienta Profesional)\n   - Conectar punta negativa del osciloscopio: A masa motor\n   - Conectar punta positiva: Al conector inyector\n   - Motor ralentí, ver en pantalla la forma de onda:\n   - Debe mostrar PULSOS RECTANGULARES claros\n   - Amplitud: 12V pico\n   - Duración: 2-3 ms típico ralentí\n   - Frecuencia: Proporcional RPM\n   - Si onda es BORROSA = solenoide gastado\n   - Si onda FALTA = no activa inyector\n\n6. PRUEBA DE SPRAY PATRÓN (Banco de Pruebas)\n   Requiere equipo especial:\n   - Presurizar inyector a presión GDI nominal (500 PSI típico para prueba)\n   - Aplicar pulso eléctrico (12V, 50 ms)\n   - Observar spray:\n     • Patrón CORRECTO: Cono atomizado fino, simétrico\n     • Patrón POBRE: Chorros gruesos irregulares\n     • SIN SPRAY: Inyector defectuoso\n   - Repetir 10-20 pulsos, patrón debe ser consistente\n   - Si patrón varía: Aguja defectuosa\n\n7. PRUEBA GOTEO (A Presión)\n   - Presurizar a 500 PSI (presión GDI baja)\n   - Quitar energía eléctrica\n   - Observar durante 60 segundos\n   - Resultado CORRECTO: NO DEBE GOTEAR\n   - Si gotea: Asiento inyector defectuoso, REEMPLAZAR\n   - Goteo = combustible entra cilindro cuando off\n\n8. PRUEBA FLUJO (Cc/min)\n   Banco de pruebas especializado:\n   - Presión: 500 PSI (GDI estandar)\n   - Duración: 60 segundos\n   - Flujo esperado (depende cilindrada motor):\n     • Motor 2.0L: 220-280 cc/min\n     • Motor 2.5L: 280-350 cc/min\n     • Motor 3.0L: 350-450 cc/min\n   - Comparar con otros inyectores del motor\n   - Diferencia >5%: Inyector defectuoso\n   - Si flujo muy bajo: Inyector parcialmente bloqueado\n\n9. PRUEBA BALANCE CILINDROS (Con Escáner)\n   - Conectar escáner OBD a vehículo\n   - Leer datos en vivo: Inyección duración cada cilindro\n   - Motor 2000 RPM, aceleración constante\n   - Lecturas deben ser similares (±0.3 ms)\n   - Si un cilindro diferente: Inyector o sensor defectuoso\n   - Desactivar cilindro sospechoso con escáner:\n     • Si misfire desaparece = inyector defectuoso\n     • Si persiste = problema bobina o bujía\n\n10. PRUEBA RESPUESTA (Osciloscopio Avanzado)\n    - Medir tiempo apertura: Debe ser <2 ms\n    - Medir tiempo cierre: Debe ser <1 ms\n    - Medir delay (retardo): <10 ms total\n    - Si retardo alto: Solenoide debilitado\n    - Si retardo variable: Conexión intermitente\n[/PRUEBAS INYECTOR GDI - LISTA COMPLETA]\n\n[ORDEN RECOMENDADO DIAGNÓSTICO]\n1. Inicio: Prueba visual y resistencia (rápido, gratis)\n2. Si normales: Prueba voltaje y pulso (necesita multímetro)\n3. Si normales: Limpiar inyector (puede resolver 60% fallas)\n4. Si persiste: Banco de pruebas flujo y spray (profesional)\n5. Si todo falla: REEMPLAZAR inyector\n\n[RESULTADOS ESPERADOS INYECTOR GDI NUEVO]\n- Resistencia: 2.5-3.5 ohms\n- Voltaje de reposo: 12V estable\n- Pulsos: 3-4A, duración 1-3 ms\n- Spray: Cono fino niebla perfecta\n- Goteo: CERO, completamente seco\n- Flujo: Exacto a especificación motor\n- Balance: ±0.2 ms con otros cilindros\n\n[SÍNTOMAS = INYECTOR DEFECTUOSO]\n- Misfire cilindro específico (código P0301-P0308)\n- Arranque difícil o lento\n- Marcha irregular ralentí\n- Falta potencia aceleración\n- Sobrecalentamiento motor\n- Falla sensor oxígeno post-catalizador\n- Mayor consumo combustible\n"
  },
  {
    title: "Limpieza de Inyectores GDI - Procedimiento Profesional",
    keywords: ["limpieza inyector gdi", "desobstrucción inyector", "depósitos inyector", "procedimiento limpieza"],
    answer: "[LIMPIEZA INYECTOR GDI - PROCEDIMIENTO PROFESIONAL]\n\n[PASO 1: PREPARACION]\n- Obtener kit limpieza de inyectores GDI (específico)\n- Herramientas necesarias:\n  • Multímetro (verificar continuidad)\n  • Compresor aire (0.5-2 bar, MUY BAJO)\n  • Disolvente GDI específico (NO usar gasolina simple)\n  • Espátula plástica (NUNCA metal)\n  • Paño limpio sin pelusas\n  • Pistola aire presión baja\n- Espacio de trabajo: Banco limpio, seco, bien iluminado\n\n[PASO 2: EXTRACCION INYECTOR]\n- Desconectar conector eléctrico\n- Drenar presión sistema combustible\n- Sacar tornillo/perno montaje inyector (típicamente 1-2 tornillos)\n- Extraer inyector CON CUIDADO (cristal frágil)\n- NO aplicar fuerza excesiva\n- Revisar anillo sello (O-ring) descontar con cuidado\n- Guardar anillo viejo para comparar tamaño\n\n[PASO 3: INSPECCIÓN INICIAL]\n- Colocar inyector sobre paño blanco\n- Observar punta del inyector:\n  • Depósitos NEGROS = quemazón\n  • Depósitos MARRONES = óxido\n  • CLEAN plateado = muy sucio si hay depósitos\n- Si completamente negro: Requiere remojo\n- Si solo sucio: Aire presión puede ser suficiente\n\n[PASO 4: LIMPIEZA CON AIRE (Primer Intento)\n★ CRÍTICO: Presión MÁXIMA 1 bar (15 PSI) ★\n- Ajustar compresor a 0.5 bar\n- Apuntar pistola aire perpendicular a orificio\n- Soplar suavemente 3-5 segundos\n- NUNCA aplicar aire directamente a esfera (puede dañar aguja)\n- Repetir 2-3 veces\n- Si se suelta deposito: ¡Éxito!\n- Si no: Pasar a remojo químico\n\n[PASO 5: REMOJO QUIMICO (Si Aire Insuficiente)\n- Colocar inyector en vaso limpio\n- Verter disolvente GDI (no gasolina)\n- Sumergir SOLO la punta (no conector eléctrico)\n- Remojo: 30-60 minutos MÍNIMO\n- Opcional: Baño ultrasónico si disponible (30 min)\n- NO frotar con cepillo (daña aguja fina)\n- Esperar hasta ver partículas suspendidas en líquido = funciona\n\n[PASO 6: LIMPIEZA POST-REMOJO]\n- Sacar inyector del disolvente\n- Usar aire presión BAJA nuevamente (0.5 bar)\n- Soplar suavemente desde todos los ángulos\n- Depósitos sueltos caerán\n- NUNCA usar cepillo metal\n- Si necesario, cepillo suave PLÁSTICO solamente\n- Secar completamente con aire limpio\n\n[PASO 7: VERIFICACION LIMPIEZA]\n- Observar punta del inyector nuevamente\n- Debe estar PLATEADA y BRILLANTE\n- Sin depósitos negros o marrones visibles\n- Si aún sucio: Repetir pasos 5-6\n- Verificar continuidad con multímetro:\n  • Debe mantener 2.5-3.5 ohms\n  • Si cambió: Daño durante limpieza, REEMPLAZAR\n\n[PASO 8: PREPARACION REINSTALACION]\n- Obtener anillo sello (O-ring) NUEVO\n- NO reutilizar anillo viejo (pierde sello)\n- Lubrificar anillo nuevo levemente con aceite motor limpio\n- Colocar anillo en ranura inyector\n- Inspeccionar asiento en culata:\n  • Debe estar limpio\n  • Si hay depósitos: Limpiar con aire presión\n  • Si está dañado: Reparar o culata requiere mantenimiento\n\n[PASO 9: REINSTALACION INYECTOR]\n- Insertar inyector con cuidado en orificio\n- Alinear suavemente (NO fuerza)\n- Roscar tornillo/perno montaje\n- Presión: 25-35 Nm (18-26 lb-ft) típicamente\n- NO apretar excesivamente (puede fracturar cerámica)\n- Conectar conector eléctrico\n- Verificar click de conexión\n\n[PASO 10: VERIFICACION FINAL]\n- Conectar escáner OBD\n- Borrar códigos de falla previos\n- Arrancar motor\n- Escuchar: Sonido debe ser más suave\n- Ralentí debe mejorar\n- Si aún hay misfire: Inyector posiblemente defectuoso, REEMPLAZAR\n\n[FRECUENCIA DE LIMPIEZA]\n- Prevención: Cada 50,000-80,000 km\n- Sintomático (misfire): Cuando problema aparece\n- Usar aditivo combustible detectados cada 10,000 km\n- Combustible de calidad = menos depósitos\n\n[ADVERTENCIAS CRÍTICAS]\n⚠️ NUNCA usar gasolina simple para remojo\n⚠️ NUNCA usar presión aire >1 bar\n⚠️ NUNCA frotar con cepillo metálico\n⚠️ NUNCA forzar extracción o reinstalación\n⚠️ NUNCA reutilizar anillo sello viejo\n⚠️ SI hay duda: REEMPLAZAR en lugar de limpiar\n\n[COSTO APROXIMADO]\n- Kit limpieza DIY: $200-400\n- Servicio profesional: $500-1000 por 4 inyectores\n- Reemplazo inyector nuevo: $300-600 por unidad\n"
  },
  {
    title: "Diagnóstico GDI - Presión Baja o Sin Presión",
    keywords: ["gdi presión baja", "gdi sin presión", "bomba combustible gdi", "diagnóstico presión gdi"],
    answer: "[DIAGNOSTICO PRESION GDI BAJA]\n\n[PASO 1: VERIFICAR PRESION ACTUAL]\n- Conectar manómetro presión combustible\n- Punto conexión: Válvula presión o rieles combustible\n- Llave ON (Motor NO encendido):\n  • Motor frío: 800-1200 kPa (8-12 bar) DEBE estar presente\n  • Si es 0 kPa: Sistema sin presión, paso 2\n  • Si es 200-400 kPa: Presión baja, paso 3\n\n[PASO 2: SI PRESION = 0 kPa (SIN PRESION)\n  \n  Verificación 1: Fusible bomba combustible\n  - Ubicación: Panel fusibles (típicamente 15-30A)\n  - Abrir panel de fusibles\n  - Buscar fusible etiquetado \"FUEL PUMP\"\n  - Inspeccionar visualmente: ¿está el cable fundido?\n  - Si está roto: REEMPLAZAR fusible\n  - Si sustituido pero vuelve a fallar: Bomba en cortocircuito\n  \n  Verificación 2: Relé bomba combustible\n  - Ubicación: Panel fusibles o motor\n  - Sonido: Escuchar click cuando llave ON\n  - Si NO hay click: Relé defectuoso, REEMPLAZAR\n  - Si hay click pero sin presión: Paso verificación 3\n  \n  Verificación 3: Conector bomba combustible suelto\n  - Ubicación: Interior tanque (bajo tapete piso)\n  - Inspeccionar conector: ¿está conectado firmemente?\n  - Jalar levemente: Debe estar seguro\n  - Si suelto: Reconectar\n  - Escuchar bomba encenderse cuando llave gira ON\n\n[PASO 3: SI PRESION 200-400 kPa (BAJA)\n  \n  Verificación 1: Filtro combustible obstruido\n  - Motor parado (seguridad)\n  - Despresurizar sistema: Abrir tapa combustible\n  - Ubicar línea combustible entrada bomba\n  - Desconectar línea seguramente\n  - Colectar combustible en vaso\n  - Revisar flujo: Debe gotear libremente\n  - Si NO sale combustible o sale lentamente:\n     • Filtro obstruido\n     • CAMBIAR filtro combustible\n  - Filtro típica: bajo vehículo o línea combustible\n  \n  Verificación 2: Regulador presión defectuoso\n  - Presión debe AUMENTAR con aceleración\n  - Ralentí: 800-1200 kPa\n  - Aceleración: Debe pasar a 1600-2000 kPa\n  - Si presión se queda baja (no sube): Regulador defectuoso\n  - REEMPLAZAR regulador presión\n  \n  Verificación 3: Bomba desgastada\n  - Edad bomba: >200,000 km probable\n  - Motor suena diferente cuando llave ON: Bomba débil\n  - Presión estable pero baja: Bomba interna desgastada\n  - REEMPLAZAR bomba combustible\n  \n  Verificación 4: Línea combustible con fuga\n  - Inspeccionar línea entrada bomba visualmente\n  - ¿Hay goteo?\n  - ¿Hay manchas de combustible?\n  - Si hay fuga: CAMBIA línea o conector\n  - Esperar motor frío antes de trabajar\n\n[PASO 4: VERIFICAR CON ESCANER OBD]\n- Conectar escáner profesional\n- Leer código de falla:\n  • P0087: Presión combustible TOO LOW\n  • P0088: Presión combustible TOO HIGH\n  • P0089: Regulador presión malfunction\n- Código indica componente específico problemático\n- Seguir recomendación código\n\n[ORDEN DIAGNOSTICO RECOMENDADO]\n1. ¿Sonido bomba al ON? -SÍ-> Problema 2-4\n2. ¿Sonido bomba al ON? -NO-> Revisión fusible/relé\n3. ¿Hay presión pero baja? -> Filtro o regulador\n4. ¿Presión correcta pero sigue código? -> Sensor presión defectuoso\n\n[SÍNTOMAS PRESION BAJA]\n- Arranque difícil o lento\n- Motor sin poder (falta aceleración)\n- Misfire múltiples cilindros\n- Código P0087 encendido\n- Motor falla después calentar\n\n[PRESIONES ESPECIFICAS GDI GENERACIONES]\nGeneración 1 (1997-2003): 1350 bar especificación\nGeneración 2 (2003-2010): 1600-1700 bar especificación  \nGeneración 3 (2010+): 1800-2000 bar especificación\nGeneración 4 (2015+): 2000-2500 bar especificación\n\nSi presión actual 60% de especificación = BAJA, diagnosticar\n"
  },
  {
    title: "Diagnóstico de Misfire en Motor GDI - Procedimiento Técnico",
    keywords: ["misfire gdi", "diagnóstico misfire", "cilindro misfire", "código p0300"],
    answer: "[DIAGNOSTICO MISFIRE GDI]\n\n[DEFINICIÓN]\nMisfire = Cilindro NO prende, producción combustible en ese cilindro no ocurre\nSíntomas: Vibración motor, falta potencia, puede ser múltiple o cilindro específico\n\n[PASO 1: LEER CODIGO OBD]\n- Conectar escáner OBD\n- Códigos misfire:\n  • P0300: Random misfire (múltiples cilindros)\n  • P0301: Misfire cilindro 1 específico\n  • P0302: Misfire cilindro 2 específico\n  • P0303: Misfire cilindro 3 específico\n  • P0304: Misfire cilindro 4 específico\n  • P0305-P0308: Cilindros 5-8 específicos\n\n- Parámetro importante: Cilindro o cilindros afectados\n- Si múltiples: Problema general (combustible, encendido, aire)\n- Si específico: Problema cilindro individual\n\n[PASO 2: DIAGNOSTICO INICIAL (VISUAL Y BASICO)\n\nSi es TODOS CILINDROS (P0300):\n  Verificación 1: Presión combustible\n  - ¿Presión <800 kPa? = Presión baja general\n  - SEGUIR diagnóstico presión baja (artículo separado)\n  \n  Verificación 2: Filtro aire obstruido\n  - Inspeccionar filtro aire\n  - ¿Está muy sucio?\n  - Si sí = CAMBIAR filtro aire\n  - Aire insuficiente = mezcla pobre = misfire\n  \n  Verificación 3: Conectores sueltos\n  - Revisar todos conectores bobina encendido\n  - Revisar todos conectores inyector\n  - Cualquier conector suelto = misfire\n  - Reconectar firmemente\n\nSi es CILINDRO ESPECÍICO (P0301-P0308):\n  Problema localizado en ese cilindro\n  SEGUIR paso 3 diagnóstico cilindro específico\n\n[PASO 3: DIAGNOSTICO CILINDRO ESPECIFICO\n\nAsumiendo código es P0301 (cilindro 1), aplicar a todos:\n\nVerificación 1: Bujía cilindro 1\n  - Sacar bujía cilindro 1\n  - Inspeccionar:\n    • ¿Está mojada? = Combustible no quema, inyector gotea\n    • ¿Está NEGRA? = Quemazón pobre, mezcla muy rica\n    • ¿Está BLANCA? = Mezcla muy pobre, aire excesivo\n    • ¿Brecha correcta? = Medir con calibrador\n  - Si bujía defectuosa = REEMPLAZAR\n  - Si bujía OK = Continuar verificación 2\n\nVerificación 2: Inyector cilindro 1\n  - Escuchar con estetoscopio (tool diagnosis)\n  - Sonido debe ser \"click click click\" rápido cuando ralentí\n  - Si silencioso = inyector no funciona\n  - Proceder PRUEBA INYECTOR GDI (artículo separado)\n\nVerificación 3: Bobina encendido cilindro 1\n  - Verificar conector: ¿conectado firmemente?\n  - Medir voltaje: 12V debe estar presente en positivo\n  - Medir pulso: Multímetro amperios debe mostrar picos 2-4A\n  - Si NO hay pulso = Bobina defectuosa, REEMPLAZAR\n  - Si hay pulso = Problema inyector (volver a verificación 2)\n\nVerificación 4: Compresión cilindro 1\n  - Sacar todas bujías para ajuste motor\n  - Conectar compresor\n  - Girar motor (starter motor) 5 revoluciones\n  - Lectura típica: 150-200 PSI\n  - Si <100 PSI = Válvulas o aro anillos problemas\n  - Si >250 PSI = Depósitos carbón\n  - Compresión es factor importante\n\n[PASO 4: DECISION DIAGNOSIS\n\nSi Misfire es TODOS CILINDROS (P0300):\n  1. Revisar presión combustible\n  2. Revisar filtro aire\n  3. Revisar conectores\n  4. Si persiste: Problema ECU o sistema\n\nSi Misfire CILINDRO ESPECIFICO:\n  Verificar orden:\n  1. Bujía del cilindro (más fácil/barato)\n  2. Inyector del cilindro\n  3. Bobina del cilindro\n  4. Compresión del cilindro\n  5. Válvula de ese cilindro\n\n[SÍNTOMAS ADICIONALES = TIPO MISFIRE]\n\nMisfire ralentí solamente:\n  = Inyector parcialmente bloqueado\n  = Presión baja (no suficiente para inyectar)\n\nMisfire durante aceleración:\n  = Bobina débil (no suficiente voltaje alto)\n  = Compresión baja (no quema bien combustible)\n\nMisfire aleatório (va y viene):\n  = Conexión intermitente\n  = Inyector intermitente\n  = Bobina debilitada\n\nMisfire después calentar:\n  = Problema térmico\n  = Inyector expandido = flujo reducido\n  = Bobina sobrecalentada\n\n[FRECUENCIA MISFIRE INDICADOR]\nCódigo P0300 (random misfire) muestra estadística:\n- Cilindro 1: 10% de fallos = Problema cilindro 1\n- Cilindro 2: 10% de fallos = Problema cilindro 2\n- Cilindro 3: 70% de fallos = Problema cilindro 3\n\nCilindro con porcentaje alta = prioritario revisar\n\n[DIAGRAMA FLUJO DIAGNOSTICO]\nP0301 (Cilindro 1 misfire)\n  ├─ Comprensión cilindro 1 OK? \n  │   ├─ NO -> Problema válvula/anillos\n  │   └─ SÍ -> Continuar\n  ├─ Voltaje bobina cilindro 1 presente?\n  │   ├─ NO -> REEMPLAZAR bobina\n  │   └─ SÍ -> Continuar\n  ├─ Pulso inyector cilindro 1 presente?\n  │   ├─ NO -> REEMPLAZAR bobina\n  │   └─ SÍ -> Continuar\n  ├─ Presión combustible OK?\n  │   ├─ NO -> Ver diagnóstico presión\n  │   └─ SÍ -> Continuar\n  └─ Inyector cilindro 1 spray correcto?\n      ├─ NO -> REEMPLAZAR inyector\n      └─ SÍ -> Problema misceláneo\n"
  }
];

async function loadGDIDiagnosticArticles() {
  console.log('Iniciando carga de Diagnóstico GDI Específico y Procedimientos...');
  console.log(`Total de articulos a insertar: ${gdiDiagnosticArticles.length}\n`);

  for (const article of gdiDiagnosticArticles) {
    try {
      const { error } = await supabase
        .from('assistant_kb')
        .insert([
          {
            title: article.title,
            keywords: article.keywords,
            answer: article.answer,
          }
        ]);

      if (error) {
        console.log(`❌ Error al insertar: ${article.title}`, error.message);
      } else {
        console.log(`✅ Insertado: ${article.title}`);
      }
    } catch (err) {
      console.log(`❌ Error: ${err.message}`);
    }
  }

  console.log(`\n✅ Proceso completado - Diagnóstico GDI Específico`);
  console.log(`Total procesado: ${gdiDiagnosticArticles.length} articulos`);
}

loadGDIDiagnosticArticles();
