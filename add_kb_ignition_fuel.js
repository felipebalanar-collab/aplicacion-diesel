import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config();

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

const ignitionFuelArticles = [
  {
    title: "Sistema de Encendido - Voltaje Bobina y Especificaciones",
    keywords: ["encendido", "bobina", "voltaje", "primario", "secundario", "kilovoltios"],
    answer: "[ESPECIFICACIONES BOBINA ENCENDIDO]\n\nVoltaje Primario:\n- Alimentación: 7-14V de batería\n- Voltaje Nominal: 12V típicamente\n- Voltaje en Conducción: 9-14V variable\n- Mínimo Requerido: 9V (sistema aún funciona)\n- Máximo Permitido: 14.5V (para no seccionar bobina)\n\nVoltaje Secundario (Arco):\n- Voltaje Generado: 8,000-30,000V (8-30 kV)\n- Voltaje en Ralentí: 8,000-12,000V\n- Voltaje en Aceleración: 15,000-20,000V\n- Voltaje Máximo: 25,000-30,000V en picos\n- Distancia Chispa: Típicamente 2-3 mm\n- Energía por Chispa: 40-80 mJ\n[/ESPECIFICACIONES BOBINA ENCENDIDO]\n\n[TIPOS DE BOBINAS]\n\nBobina Distribuida (Distributor Coil):\n- Tipo: Una bobina central\n- Voltaje Secundario: 8-12 kV\n- Distribuidor: Rotor mecánico\n- Antigüedad: Motores pre-1990s\n- Común: Vehículos antiguos\n\nBobina Individual por Cilindro (Coil-Over-Plug):\n- Tipo: Una bobina POR bujía\n- Voltaje Secundario: 20-30 kV\n- Distribuidor: Controlado electrónicamente\n- Antigüedad: 1990s+\n- Ventaja: Mayor voltaje, mejor combustión\n\nBobina Doble (Pencil Coils):\n- Tipo: Una bobina para 2 cilindros\n- Voltaje Secundario: 15-20 kV\n- Configuración: 2 salidas secundarias\n- Antigüedad: Transición 1980s-1990s\n[/TIPOS DE BOBINAS]\n\n[DIAGNOSTICO VOLTAJE PRIMARIO]\n\n1. Llave OFF (Motor Apagado):\n   - Voltaje: 0V en bobina\n   - Continuidad: Debe haber continuidad a masa\n\n2. Llave ON (Motor Parado):\n   - Voltaje bobina positivo: 7-14V (depende carga)\n   - Voltaje bobina tierra: 0V\n\n3. Motor Encendido Ralentí:\n   - Voltaje debe MODULAR (cambiar)\n   - Rango: 2-6V típicamente\n   - Modulación: Señal proporcional a RPM\n   - Si voltaje fijo: Distribuidor defectuoso\n\n4. Motor Aceleración:\n   - Voltaje DEBE cambiar más rápido\n   - Frecuencia aumenta con RPM\n   - Si no modula = defecto control\n[/DIAGNOSTICO VOLTAJE PRIMARIO]\n\n[DIAGNOSTICO VOLTAJE SECUNDARIO]\n\n1. Prueba Oscilógrafo:\n   - Conectar tierra negadora\n   - Medir chispa entre electrodo bujía\n   - Voltaje debe estar 8-30 kV dependiendo RPM\n   - Chispa debe ser definida, no difusa\n\n2. Prueba Resistencia (Motor Apagado):\n   - Primario: Típicamente 0.4-2 ohms\n   - Secundario: Típicamente 6,000-10,000 ohms\n   - Si diferentes: Bobina dañada\n\n3. Prueba Continuidad:\n   - Debe haber continuidad primario\n   - Debe estar aislado (no continuidad) secundario a primario\n   - Si hay continuidad = bobina quemada internamente\n\n4. Test Inductancia:\n   - Primary: 3-8 Henry típicamente\n   - Secondary: 8,000-12,000 Henry\n   - Medición especializada con inductancímetro\n[/DIAGNOSTICO VOLTAJE SECUNDARIO]\n\n[PROBLEMAS COMUNES]\n\nBobina Débil (Bajo Voltaje):\n- Voltaje secundario <10 kV\n- Encendido débil, difícil arrancar\n- Motor irregular\n- Causa: Bobina envejecida, primario débil\n\nBobina Abierta (Sin Voltaje):\n- Ningún voltaje secundario\n- Motor no enciende, no inicia\n- Causa: Bobina quemada, conector suelto\n\nBobina con Fugas:\n- Voltaje sale por costados\n- Chispa débil o nula\n- Causa: Bobina mojada, aislamiento dañado\n\nBobina Sobrecalentada:\n- Olor a quemado\n- Falla después de calentar\n- Causa: Resistencia interna alta, ciclo trabajo alto\n[/PROBLEMAS COMUNES]\n\n[CODIGOS OBD]\nP0350: Ignition coil malfunction\nP0351-P0358: Ignition coil A-H malfunction (específico cilindro)\nP0370: Timing reference high resolution signal malfunction\n[/CODIGOS OBD]"
  },
  {
    title: "Bujías - Especificaciones de Brecha y Voltaje",
    keywords: ["bujía", "brecha", "spark plug", "electrodo", "voltaje", "gap"],
    answer: "[ESPECIFICACIONES BRECHA (GAP)]\n\nBrecha Estándar:\n- Motores Convencionales: 0.028-0.035 pulgadas (0.7-0.9 mm)\n- Motores Turbos: 0.025-0.030 pulgadas (0.6-0.8 mm)\n- Motores GDI: 0.020-0.028 pulgadas (0.5-0.7 mm)\n- Motores Diesel: N/A (usan calentadores glow plug)\n\nBrecha vs Performance:\n- Brecha Pequeña (<0.6 mm): Menor voltaje requerido, inicio fácil\n- Brecha Grandes (>0.9 mm): Mayor voltaje, mejor chispa, gasto energético\n- Óptima: 0.7-0.9 mm para mayoría aplicaciones\n\nCalibre Verificación:\n- Usar calibrador específico (wire gauge)\n- Medidas: 0.5 mm, 0.6 mm, 0.7 mm, 0.8 mm, 0.9 mm\n- Verificar cada reemplazo de bujía\n[/ESPECIFICACIONES BRECHA (GAP)]\n\n[VOLTAJE REQUERIDO POR GAP]\n\n0.5 mm (0.020\"): 8-12 kV\n0.6 mm (0.024\"): 12-15 kV\n0.7 mm (0.028\"): 14-18 kV\n0.8 mm (0.031\"): 18-22 kV\n0.9 mm (0.035\"): 22-30 kV\n1.0 mm (0.039\"): >30 kV (máximo para bobinas estándar)\n\nFórmula Aproximada:\n- Voltaje requerido ≈ 3 kV por 0.1 mm de brecha\n[/VOLTAJE REQUERIDO POR GAP]\n\n[TIPOS DE BUJIAS]\n\nBujía Estándar (Níquel):\n- Electrodo Material: Níquel\n- Vida Útil: 20,000-50,000 km\n- Costo: Bajo\n- Voltaje Requerido: 12-15 kV\n- Aplicación: Motores convencionales\n\nBujía Platino:\n- Electrodo Central: Platino\n- Electrodo Masa: Platino\n- Vida Útil: 60,000-100,000 km\n- Voltaje Requerido: 12-15 kV (mismo que níquel)\n- Costo: 2-3x más caro\n- Ventaja: Mayor durabilidad\n\nBujía Iridio:\n- Electrodo Central: Iridio\n- Electrodo Masa: Platino\n- Vida Útil: 100,000-150,000 km\n- Voltaje Requerido: 12-18 kV\n- Costo: 3-5x más caro que níquel\n- Ventaja: Mejor rendimiento, mayor vida\n[/TIPOS DE BUJIAS]\n\n[DIAGNOSTICO BUJIA]\n\n1. Inspección Visual (Desconectar):\n   - Color Ideal: Gris claro o café\n   - Depósitos Negros: Quemazón de aceite\n   - Depósitos Blancos: Mezcla muy pobre\n   - Depósitos Café: Quemazón normal\n   - Arco Oscuro: Posible falla\n\n2. Medida Brecha:\n   - Usar calibrador de wire\n   - Verificar cada bujía\n   - Si brecha aumentó: Bujía gastada\n   - Si brecha diferente entre cilindros: Problema individual\n\n3. Resistencia Eléctrica:\n   - Bujía Estándar: <1 ohmio típicamente\n   - Bujía Resistida: 3,500-7,500 ohmios (resistor externo)\n   - Verificar ambos extremos\n\n4. Prueba de Encendido:\n   - Presionar centro tierra\n   - Aplicar voltaje:\n     • Brecha correcta: Chispa fuerte, azulada\n     • Brecha larga: Chispa débil o nula\n     • Si no enciende: Bujía defectuosa\n[/DIAGNOSTICO BUJIA]\n\n[CODIGOS OBD]\nP0300: Random misfire detected\nP0301-P0308: Cylinder 1-8 misfire detected\nP0351-P0358: Ignition coil specific fault (relacionado bujía/bobina)\n[/CODIGOS OBD]\n\n[MANTENIMIENTO]\n- Reemplazo Bujías Estándar: Cada 20,000-30,000 km\n- Reemplazo Bujías Platino: Cada 60,000 km\n- Reemplazo Bujías Iridio: Cada 100,000 km\n- Verificar Brecha: Cada mantenimiento\n- Usar Especificación OEM: NUNCA variar de especificación\n[/MANTENIMIENTO]"
  },
  {
    title: "Bomba de Combustible Eléctrica - Voltaje y Presión Especificaciones",
    keywords: ["bomba combustible", "voltaje", "presión", "amperaje", "motor eléctrico"],
    answer: "[ESPECIFICACIONES PRESION BOMBA]\n\nMotores Aspirados (Sin Turbo):\n- Presión Nominal: 35-45 PSI (240-310 kPa)\n- Presión Mínima Operación: 30 PSI (207 kPa)\n- Presión Máxima: 50 PSI (345 kPa) antes regulador\n\nMotores Turbo:\n- Presión Nominal: 40-55 PSI (276-379 kPa)\n- Presión Mínima: 35 PSI (241 kPa)\n- Presión Máxima: 60 PSI (414 kPa)\n\nMotores Diesel (Low Pressure Pump):\n- Presión: 3-5 PSI (20-35 kPa)\n- Función: Solo llevar combustible a bomba alta presión\n\nMotores Diesel (High Pressure Pump):\n- Ver artículo sobre bombas diesel\n- Presión common rail: 1600-3000 PSI (11-207 bar)\n[/ESPECIFICACIONES PRESION BOMBA]\n\n[ESPECIFICACIONES ELECTRICAS]\n\nVoltaje de Alimentación:\n- Nominal: 12V (sistemas convencionales)\n- Rango Normal: 10.8-14.4V\n- Mínimo para Funcionar: 9.6V\n- Durante Arranque: Puede bajar a 8.5V (válido temporalmente)\n\nConsumo Corriente:\n- Bomba Pequeña: 4-8 Amperios\n- Bomba Mediana: 8-12 Amperios\n- Bomba Grande/Turbo: 12-20 Amperios\n- Pico Inicio: Puede ser 2x inicialmente\n\nFusible Protección:\n- Típicamente: 15-30 Amperios\n- Corresponde a bomba: Aprox 20% más que consumo máximo\n- Ubicación: Panel de fusibles, usualmente etiquetada \"FUEL PUMP\"\n\nRelé Bomba:\n- Alimentación Primario: 12V\n- Alimentación Secundario: 12V a bomba\n- Activación: Señal 0.5V de ECU\n- Función: Proteger ECU de picos corriente\n[/ESPECIFICACIONES ELECTRICAS]\n\n[DIAGNOSTICO PRESION]\n\n1. Punto de Medición:\n   - Conexión Diagnóstica (si existe)\n   - Línea salida bomba (antes de regulador)\n   - Línea raíl combustible (después regulador)\n\n2. Motor Parado:\n   - Presión debe ser 0 (no hay potencia bomba)\n\n3. Llave ON (Motor NO Encendido):\n   - Priming: Bomba debe correr 1-2 segundos\n   - Presión sube rápidamente a especificación\n   - Presión luego BAJA cuando bomba se apaga\n   - Presión ESTABLE a especificación\n\n4. Motor Encendido Ralentí:\n   - Presión debe estar en especificación (ej: 40-45 PSI)\n   - Levemente variable pero estable\n   - Regular de inyector = leve pulso de presión\n\n5. Motor Aceleración:\n   - Presión debe permanecer estable\n   - Incluso con WOT\n   - Si baja: Regulador o bomba defectuosa\n\n[/DIAGNOSTICO PRESION]\n\n[DIAGNOSTICO VOLTAJE]\n\n1. Circuito Abierto (Sin Energizar):\n   - Voltaje inicio: 12V en borne bomba\n   - Cuando llave ON: Voltaje baja a 2-3V (regulado por relé)\n   - Si permanece 0V: Relé defectuoso o fusible quemado\n\n2. Con Bomba Funcionando:\n   - Voltaje: 10.5-14.0V\n   - Si <8V: Caída voltaje, revisar cableado\n   - Si >14.5V: Posible problema cargador\n\n3. Test de Amperaje:\n   - Multímetro en serie\n   - Amperaje estado estable: Según especificación bomba\n   - Amperaje alto (2x nominal): Posible bloqueo, bomba débil\n   - Amperaje bajo: Bomba defectuosa\n[/DIAGNOSTICO VOLTAJE]\n\n[PROBLEMAS COMUNES]\n\nPresión Baja (<30 PSI):\n- Bomba defectuosa o desgastada\n- Filtro combustible obstruido\n- Regulador presión defectuoso\n- Fugas en líneas combustible\n- Cableado malo, voltaje bajo\n\nPresión Muy Alta (>60 PSI):\n- Regulador presión atascado\n- Línea retorno regulador bloqueada\n- Sensor presión defectuoso (si bomba variable)\n\nBomba No Gira:\n- Fusible quemado\n- Relé defectuoso\n- Cableado desconectado\n- Bomba quemada/atascada\n\nBomba Ruidosa:\n- Bombea aire (entrada seca)\n- Cavitación por presión baja\n- Bomba internamente dañada\n- Tanque nivel bajo\n[/PROBLEMAS COMUNES]\n\n[CODIGOS OBD]\nP0087: Fuel pressure too low\nP0088: Fuel pressure too high\nP0089: Fuel pressure regulator control open/low/high\nP0230: Fuel pump circuit malfunction\nP0231: Fuel pump circuit low voltage\nP0232: Fuel pump circuit high voltage\n[/CODIGOS OBD]"
  },
  {
    title: "Inyector de Combustible Presición - Voltaje, Corriente y Flujo",
    keywords: ["inyector", "voltaje", "corriente", "flujo", "cc/min", "microsegundos", "solenoide"],
    answer: "[ESPECIFICACIONES ELECTRICAS INYECTOR]\n\nVoltaje de Operación:\n- Alimentación Normal: 12V nominal\n- Rango de Trabajo: 10.5-14.5V\n- Voltaje Mínimo: 8.0V (degradado, no óptimo)\n- Voltaje Máximo: 15.0V (puede dañar)\n\nCorriente Consumo:\n- Pico Inicial: 2-6 Amperios\n- Corriente Estable: 0.5-1.5 Amperios\n- Duración Pulso: 0.8-3.0 milisegundos típicamente\n- Total Energía: 5-20 milijoules por inyección\n\nResistencia Inyector:\n- Baja Impedancia: 0.8-5 ohms\n- Alta Impedancia: 10-15 ohms\n- Tipo Bobinado: Determina impedancia\n[/ESPECIFICACIONES ELECTRICAS INYECTOR]\n\n[ESPECIFICACIONES FLUJO]\n\nCaudal Típico por Cilindro:\n- Motor 1.6L: 180-220 cc/min\n- Motor 2.0L: 220-280 cc/min\n- Motor 2.5L: 280-350 cc/min\n- Motor 3.0L+: 350-500+ cc/min\n\nVariación Inyector a Inyector:\n- Máxima Permitida: ±5% entre cilindros\n- Si diferencia >10%: Inyector defectuoso\n- Medición: Cc/min a presión especificada\n\nVelocidad Respuesta:\n- Tiempo Abierto (Opening Time): 2-6 ms\n- Tiempo Cierre (Closing Time): 1-3 ms\n- Total Delay: <10 ms\n[/ESPECIFICACIONES FLUJO]\n\n[TIPOS DE INYECTORES]\n\nInyector De Solenoide Estándar:\n- Tipo: Bobina + núcleo magnético\n- Respuesta: 2-5 ms\n- Energía Requerida: Moderada\n- Común: Gasolina 2000s+\n\nInyector Piezoeléctrico:\n- Tipo: Cristal piezoeléctrico\n- Respuesta: <1 ms (muy rápido)\n- Energía: Requiere 60V+ (convertidor)\n- Común: Gasolina moderna, GDI\n- Ventaja: Múltiples inyecciones por ciclo posible\n\nInyector Common Rail Diesel:\n- Tipo: Solenoide + aguja de precisión\n- Respuesta: 0.5-2 ms\n- Presión Trabajo: 1600-3000 PSI\n- Energía: 12-24V controlado\n- Ventaja: Presión constantemente disponible\n[/TIPOS DE INYECTORES]\n\n[DIAGNOSTICO VOLTAJE Y CORRIENTE]\n\n1. Inyector Desconectado:\n   - Medir resistencia bobina\n   - Baja Impedancia: 0.8-5 ohms\n   - Alta Impedancia: 10-15 ohms\n   - Si >20 ohms: Inyector abierto, defectuoso\n   - Si <0.2 ohms: Inyector en cortocircuito, defectuoso\n\n2. Con Motor Funcionando:\n   - Conectar multímetro en corriente\n   - Fase 1 - Apertura: Pico alto 2-6A\n   - Fase 2 - Mantenimiento: Baja a 0.5-1.5A\n   - Fase 3 - Cierre: Caída abrupta a 0A\n   - Patrón debe repetirse cada ciclo motor\n\n3. Duración Pulso:\n   - Ralentí: 2-3 ms\n   - 2000 RPM: 4-6 ms\n   - Aceleración: 7-10+ ms\n   - WOT: 15-20 ms maximum\n   - Debe correlacionar con RPM engine\n\n4. Test Osciloscopio:\n   - Medir inyección en 4 cilindros\n   - Duración debe ser similar (±0.5 ms)\n   - Amplitud corriente debe ser similar\n   - Si uno diferente: Inyector defectuoso\n[/DIAGNOSTICO VOLTAJE Y CORRIENTE]\n\n[DIAGNOSTICO FLUJO]\n\n1. Test Flujo Limpieza:\n   - Extraer inyector sin motor\n   - Aplicar 12V-24V controlado\n   - Inyector debe rociar \nperfectamente\n   - No debe gotear\n   - Si gotea: Asiento defectuoso, reemplazar\n\n2. Test Flujo Banco:\n   - Especial equipment requerido\n   - Medir cc durante 60 seg\n   - Típicamente a presión especificada\n   - Comparar con especificación\n   - Si diferencia >5%: Inyector defectuoso\n\n3. Test en Vehículo:\n   - Escáner: Leer consumo combustible\n   - Comparar cilindrosindividuales\n   - Si ratio desbalanceado: Inyector defectuoso\n[/DIAGNOSTICO FLUJO]\n\n[PROBLEMAS COMUNES]\n\nInyector Bloqueado:\n- Spray patrón pobre\n- Misfire específico cilindro\n- Causa: Depósitos carbón, combustible sucio\n- Solución: Limpieza o reemplazo\n\nInyector Gotea:\n- Goteo después apagar motor\n- Acumulación combustible en cilindro\n- Causa: Asiento defectuoso\n- Solución: Reemplazo inyector\n\nInyector No Enciende:\n- No hay pulso eléctrico\n- Motor no enciende\n- Causa: Bobina defectuosa, cableado roto\n- Solución: Reemplazo inyector o reparación cableado\n\nInyector Débil (Bajo Flujo):\n- Arranque difícil\n- Misfire en ralentí\n- Causa: Desgaste, depósitos\n- Solución: Limpieza (temporal) o reemplazo\n[/PROBLEMAS COMUNES]"
  }
];

async function loadIgnitionFuelArticles() {
  console.log('Iniciando carga de Sistemas de Encendido y Combustible Precisos...');
  console.log(`Total de articulos a insertar: ${ignitionFuelArticles.length}\n`);

  for (const article of ignitionFuelArticles) {
    try {
      const { error } = await supabase
        .from('assistant_kb')
        .insert([
          {
            title: article.title,
            keywords: article.keywords,
            answer: article.answer,
          }
        ]);

      if (error) {
        console.log(`❌ Error al insertar: ${article.title}`, error.message);
      } else {
        console.log(`✅ Insertado: ${article.title}`);
      }
    } catch (err) {
      console.log(`❌ Error: ${err.message}`);
    }
  }

  console.log(`\n✅ Proceso completado - Encendido y Combustible`);
  console.log(`Total procesado: ${ignitionFuelArticles.length} articulos`);
}

loadIgnitionFuelArticles();
