import { createClient } from '@supabase/supabase-js';
import dotenv from 'dotenv';

dotenv.config();

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
);

const transmissionArticles = [
  {
    title: "Presión Transmisión Automática - Especificaciones por Tipo",
    keywords: ["transmisión", "presión línea", "presión trabajo", "bar", "psi", "válvula solenoide"],
    answer: "[PRESIONES DE TRANSMISION AUTOMATICA]\n\nPresión de Línea Principal (Line Pressure):\n- Ralentí (P/N): 200-300 kPa (2-3 bar / 29-43 PSI)\n- D (Dirección): 300-500 kPa (3-5 bar / 43-72 PSI)\n- Aceleración Suave: 500-800 kPa (5-8 bar / 72-115 PSI)\n- WOT (Aceleración Máxima): 800-1200 kPa (8-12 bar / 115-175 PSI)\n\nPresión Convertidor de Torque:\n- Ralajado (Acoplado): 100-300 kPa (1-3 bar / 14-43 PSI)\n- Activado: 500-1200 kPa (5-12 bar / 72-175 PSI)\n\nPresión Frenos (Apply): 600-1500 kPa (6-15 bar / 87-217 PSI)\nPresión Embrague (Clutch): 400-1000 kPa (4-10 bar / 58-145 PSI)\n[/PRESIONES DE TRANSMISION AUTOMATICA]\n\n[ESPECIFICACIONES POR TIPO DE TRANSMISION]\n\nTransmisión TorqueFlite (Chrysler):\n- Presión Línea: 500 kPa ralentí\n- WOT: 1000-1200 kPa\n- 4 velocidades: 200R, 41RE, 42RH, 46RE, 47RE\n\nTransmisión 4L60E (GM):\n- Presión Línea: 400-600 kPa ralentí\n- WOT: 1200+ kPa\n- Banda servo presión: 400-500 kPa\n\nTransmisión 5R55E (Ford):\n- Presión Línea: 300-400 kPa ralentí\n- WOT: 800-1000 kPa\n- Regulador presión: 280 kPa\n\nTransmisión ZF (Aplicaciones Europeas):\n- 5HP19: 500-700 kPa ralentí\n- 5HP24: 600-800 kPa ralentí\n- 6HP26: 300-500 kPa ralentí\n- WOT: 1200+ kPa\n\nTransmisión Jatco (Nissan):\n- CVT: Presión variable 50-200 kPa\nRE4F04A: 400 kPa ralentí\n[/ESPECIFICACIONES POR TIPO DE TRANSMISION]\n\n[VOLTAJES Y AMPERAJE SOLENOIDES]\n\nSolenoide de Cambio (Shift Solenoid):\n- Alimentación: 7-14V\n- Corriente: 0.3-1.5 A\n- Duty Cycle: 0-100%\n- Resistencia: 4-10 ohms\n\nSolenoide de Bloqueo Convertidor (Lock-up):\n- Alimentación: 7-14V\n- Corriente: 0.3-1.0 A\n- PWM Frequency: 10-100 Hz\n- Resistencia: 5-15 ohms\n\nSolenoide Presión Principal (Pressure Control):\n- Alimentación: 7-14V\n- Corriente: 0.5-2.0 A\n- Modulación: Precisa PWM\n[/VOLTAJES Y AMPERAJE SOLENOIDES]\n\n[DIAGNOSTICO DE PRESION]\n1. Punto de Medición:\n   - Toma diagnóstico de transmisión (si existe)\n   - Línea presión principal\n   - Manómetro de 0-2500 kPa\n\n2. Lectura en Ralentí:\n   - Debe estar dentro ±100 kPa especificación\n   - Si baja: Bomba defectuosa, válvula reguladora\n   - Si alta: Válvula reguladora atascada\n\n3. Lectura en Aceleración:\n   - Debe aumentar linealmente con apertura acelerador\n   - Si no aumenta: Modulator defectuoso (si existe)\n   - Si fluct\u00faa: Problema solenoide presión\n\n4. Después Cambio de Marcha:\n   - Presión debe ser consistente\n   - No debe temblar o saltar\n[/DIAGNOSTICO DE PRESION]\n\n[PROBLEMAS COMUNES]\nPresión Baja:\n- Bomba de transmisión defectuosa\n- Fugas en sello bomba\n- Filtro obstruido\n- Válvula reguladora atascada\n- Síntomas: Deslizamientos, cambios bruscos\n\nPresión Alta:\n- Válvula reguladora atascada cerrada\n- Modulator roto (si tiene)\n- Solenoide presión defectuoso\n- Síntomas: Cambios duros, sobrecalentamiento\n\nPresión Errática:\n- Sensor de presión defectuoso\n- Cableado intermitente\n- Solenoide con mala conexión\n- Síntomas: Cambios impredecibles\n[/PROBLEMAS COMUNES]"
  },
  {
    title: "Sensor de Velocidad Rueda (Wheel Speed) - Especificaciones ABS",
    keywords: ["abs", "sensor velocidad rueda", "inductivo", "resistencia", "voltaje", "hertz"],
    answer: "[TIPOS DE SENSORES VELOCIDAD RUEDA]\n\nSensor Inductivo (Pasivo):\n- Tipo: Bobina inductiva + anillo de pulsos\n- Voltaje de Salida: 0.2-5V AC típicamente\n- Frecuencia: 5-500 Hz (varía con velocidad)\n- Rango Temperatura: -50°C a +120°C\n- Resistencia Bobina: 200-900 ohms\n- Aplicaciones: Vehículos 1980s-2000s\n\nSensor Activado (Hall Effect):\n- Tipo: Transistor Hall + imán\n- Voltaje Salida: 0-5V digital\n- Frecuencia: Proporcional RPM rueda\n- Amplitud Constante: No depende velocidad\n- Resistencia: Variable con estado (ON/OFF)\n- Aplicaciones: Modernos 2000+\n\nSensor Magnético Pasivo (Hípster/Tachometric):\n- Tipo: Similar al inductivo, mejor performance\n- Voltaje Salida: 0.5-10V AC\n- Frecuencia: Proporcional a velocidad rueda\n- Rango Temperatura: -40°C a +90°C\n[/TIPOS DE SENSORES VELOCIDAD RUEDA]\n\n[ESPECIFICACIONES ELECTRICAS]\n\nSensor Pasivo (Inductivo):\n- Voltaje Rol Lento (0.5 km/h): 0.2V\n- Voltaje Rol Normal (20 km/h): 1-2V\n- Voltaje Rol Rápido (100 km/h): 3-5V\n- Fórmula: Voltaje proporcional a velocidad de rueda\n\nSensor Activo (Hall):\n- Voltaje Alto (ON): 4.5-5.0V\n- Voltaje Bajo (OFF): 0.0-0.5V\n- Cambio de Estado: ~50 µs\n- Ciclo de trabajo: 50% típicamente\n[/ESPECIFICACIONES ELECTRICAS]\n\n[UBICACION POR FABRICANTE]\nFord: En cubo rueda o brazo de suspensión\nGM: Integrado en rotor freno\nToyota: En cubo rueda o diferencial\nHonda: En cubo rueda directo\nVolkswagen: En soporte suspensión\nMercedes: En soporte inferior\nBMW: En soporte de suspensión\n[/UBICACION POR FABRICANTE]\n\n[DIAGNOSTICO DE SENSOR]\n1. Visual:\n   - Revisar conexión conector\n   - Verificar holgura del anillo de pulsos\n   - Revisar distancia de entrehierro (gap): 0.3-1.5mm\n\n2. Eléctrico Pasivo:\n   - Medir resistencia bobina: 200-900 ohms\n   - No debe haber continuidad a tierra\n   - Rotar rueda lentamente observar voltaje AC\n   - Debe haber Voltaje AC (0.2V+)\n   - Si no hay: Sensor defectuoso o gap incorrecto\n\n3. Eléctrico Activo:\n   - Medir voltaje con llave ON: 5V en alimentación\n   - Rotar rueda:\n   - Voltaje debe conmutar 0-5V\n   - Frecuencia debe aumentar con RPM\n   - Si no conmuta: Sensor defectuoso\n\n4. Con Escáner:\n   - Leer velocidad de rueda en panel\n   - Cada rueda debe ser similar (±5 km/h)\n   - Si una rueda es diferente: Sensor de esa rueda defectuoso\n[/DIAGNOSTICO DE SENSOR]\n\n[CODIGOS DE FALLA ABS]\nC0035-C0038: Sensor velocidad rueda defectuoso (por rueda)\nC0040-C0043: Circuito sensor abierto (por rueda)\nC0055-C0058: Señal sensor incoherente (por rueda)\nC0110: Falla ECU módulo ABS\nC0200: Cannot initialize ABS\n[/CODIGOS DE FALLA ABS]\n\n[MANTENIMIENTO]\n- Limpiar sensor cada 50,000 km (si sucio)\n- Revisar gap anillo de pulsos anualmente\n- Reemplazar sensor si está defectuoso (no reparable)\n- Verificar frenado ABS cada 100,000 km\n[/MANTENIMIENTO]"
  },
  {
    title: "Amortiguadores y Sensores de Suspensión - Especificaciones Técnicas",
    keywords: ["amortiguador", "suspensión", "sensor altura", "sensor nivel", "oxígeno", "presión"],
    answer: "[TIPOS DE AMORTIGUADORES]\n\nAmortiguador Pasivo (Damper):\n- Resistencia Interna: 200-500 PSI\n- Presión Gas: 100-150 PSI típicamente\n- Movimiento: Completamente pasivo\n- Respuesta: 50-500 ms\n- Aplicación: Mayoría vehículos\n\nAmortiguador Semi-Activo (Adaptive):\n- Válvula Solenoide: 7-14 V controlada\n- 2-10 Posiciones: Ajuste continuo\n- Respuesta: <10 ms\n- Sensores: Acelerómetros + sensores suspensión\n- Aplicación: BMW, Mercedes, Audi\n\nAmortiguador Activo (Air Suspension):\n- Presión de Aire: 800-1200 kPa (8-12 bar)\n- Compresor: 12-24V eléctrico\n- Válvulas Solenoide: 4-10 por rueda\n- Ajuste: Tiempo Real continuamente\n- Aplicación: Lujo y performance\n[/TIPOS DE AMORTIGUADORES]\n\n[PRESIONES DE AIRE (AIR SUSPENSION)]\nNivel Bajo (Carga Mínima): 900-1000 kPa (9-10 bar)\nNivel Normal (Carga Estándar): 1000-1100 kPa (10-11 bar)\nNivel Alto (Carga Máxima): 1100-1200 kPa (11-12 bar)\nNivel Autopista (Deportivo): 1200-1400 kPa (12-14 bar)\nNivel Parqueo: 800-900 kPa (8-9 bar)\n[/PRESIONES DE AIRE (AIR SUSPENSION)]\n\n[SENSORES DE ALTURA]\n\nSensor de Altura (Ride Height):\n- Tipo: Potenciómetro o LVDT\n- Alimentación: 5V típicamente\n- Salida: 0-5V análogo\n- Si Bajo (<1V): Suspensión hundida\n- Si Normal (2.5V): Altura óptima\n- Si Alto (>4V): Suspensión levantada\n\nSensor de Aceleración (Acelómetro):\n- Alimentación: 5V típicamente\n- Salida Eje X,Y,Z: 0-5V cada eje\n- Rango: ±2G típicamente\n- Respuesta: <10 ms\n- Detecta: Boches, frenadas, aceleración\n[/SENSORES DE ALTURA]\n\n[DIAGNOSTICO DE AMORTIGUADORES]\n\n1. Visual:\n   - Revisar fugas de aceite\n   - Revisar deformaciones\n   - Revisar montaje y tuercas\n\n2. Prueba de Rebote:\n   - Empujar carrocería firmemente\n   - Deber rebotar 1-2 veces\n   - Si rebota >3 veces: Amortiguador debilitado\n   - Si no rebota: Amortiguador muy duro o bloqueado\n\n3. Prueba de Carretera:\n   - Conducir en carretera con baches\n   - Debe absorber golpes suavemente\n   - No debe temblar o vibrar excesivamente\n   - No debe hundirse en aceleraciones fuertes\n\n4. Presión Aire (Si aplica):\n   - Medir con manómetro 0-2000 kPa\n   - Comparar 4 esquinas: deben ser similares\n   - Diferencia >100 kPa = válvula defectuosa\n   - Si baja presión: Pérdida de aire\n[/DIAGNOSTICO DE AMORTIGUADORES]\n\n[PROBLEMAS COMUNES]\nAmortiguador Débil:\n- Presión interna baja\n- Aceite con fugas\n- Válvula interna defectuosa\n- Síntomas: Rebota mucho, mal manejo\n\nAmortiguador Bloqueado:\n- Vástago atascado\n- Depósitos internos\n- Aceite muy viscoso\n- Síntomas: Muy duro, no rebota\n\nSuspensión Adaptativa Falla:\n- Solenoide defectuoso\n- Sensor defectuoso\n- Cableado intermitente\n- Síntomas: Suspensión rígida o muy blanda\n\nAir Suspension Baja:\n- Compresor defectuoso\n- Válvulas solenoide defectuosas\n- Líneas de aire con fugas\n- Síntomas: Vehículo baja constantemente\n[/PROBLEMAS COMUNES]\n\n[MANTENIMIENTO]\n- Revisión visual cada 20,000 km\n- Reemplazo recomendado: 80,000-100,000 km\n- Air Suspension: Revisar presión cada 10,000 km\n- Cambio aceite sistema adaptativo: 50,000 km\n[/MANTENIMIENTO]"
  },
  {
    title: "Sistema de Frenado ABS - Presión y Diagnóstico Técnico",
    keywords: ["abs", "frenado", "presión freno", "solenoide", "bar", "psi"],
    answer: "[ESPECIFICACIONES DE PRESION]\n\nPresión de Frenado Normal:\n- Sistema Convencional: 0-140 bar (0-2030 PSI)\n- Sistema ABS Activo: 50-140 bar (725-2030 PSI)\n- Presión Máxima Motor: 200+ bar (2900 PSI)\n- Presión de Línea: Proporcional a pedal\n\nPresión Cilindro Maestro:\n- Reposo: 0 bar\n- Freno Suave: 20-50 bar (290-725 PSI)\n- Freno Medio: 50-100 bar (725-1450 PSI)\n- Frenada Máxima: 100-140 bar (1450-2030 PSI)\n[/ESPECIFICACIONES DE PRESION]\n\n[COMPONENTES ABS ELECTRONICO]\n\nMotor Hidráulico:\n- Voltaje: 7-14V\n- Corriente: 5-15 A\n- Potencia: 100-200W\n- Función: Bombea líquido en ciclos cortos\n\nVálvulas Solenoide:\n- Alimentación: 7-14V\n- Corriente: 0.5-2.0 A\n- Duty Cycle: 0-100%\n- Función: Modula presión en cada circuito\n- Cantidad: 2-4 solenoides típicamente\n\nSensores Rueda:\n- Tipo: VER artículo separado\n- Función: Detectar bloqueo rueda\n- Señal: PWM digital\n[/COMPONENTES ABS ELECTRONICO]\n\n[VOLTAJES DE SOLENOIDE ABS]\n\nVálvula de Apertura (Inlet):\n- ON (Abierto): 12V, permite presión\n- OFF (Cerrado): 0V\n- Respuesta: <10 ms\n\nVálvula de Cierre (Outlet):\n- ON (Abierto): 12V, libera presión\n- OFF (Cerrado): 0V\n- Respuesta: <10 ms\n\nSecuencia Normal:\n1. Freno aplicado: Solenoides inlet ON\n2. Rueda bloquea detectado: Inlet OFF, outlet ON\n3. Presión baja: Outlet OFF, inlet ON (reconoexión)\n4. Ciclo repite: 10-15 veces por segundo\n[/VOLTAJES DE SOLENOIDE ABS]\n\n[DIAGNOSTICO DE PRESION]\n1. Punto Medición:\n   - Cilindro maestro salida\n   - Antes de válvulas solenoide ABS\n   - Línea principal de freno\n\n2. Car Estacionado:\n   - Presión inicial: 0 bar\n   - Motor parado: 0 bar\n\n3. Motor Encendido:\n   - Esperado: 0 bar (solenoides en reposo)\n   - Si hay presión: Válvula entrada abierta\n\n4. Freno Suave (1 seg):\n   - Presión sube lentamente a 30-50 bar\n   - Debe ser lineal con pedal\n   - Sin saltos o variaciones\n\n5. Freno Fuerte:\n   - Presión debe alcanzar 100-140 bar máximo\n   - Si no llega: Sensor/válvula ABS defectuoso\n   - Si sobrepasa: Regulador maestro defectuoso\n\n6. En Bache (Rueda Bloquea):\n   - Presión debe fluctuar 20-50 bar\n   - Frecuencia: 10-15 Hz aproximadamente\n   - Si no fluctúa: ABS no modulando\n[/DIAGNOSTICO DE PRESION]\n\n[CODIGOS DE FALLA DYC/ABS]\nC0101: Falla general ABS\nC0110: ABS no inicializa\nC0121-C0124: Sensor velocidad rueda defectuoso\nC0135-C0138: Circuito sensor abierto\nC0145-C0148: Señal sensor incoherente\nC0196: Voltaje batería bajo\nC0202: Falla solenoide ABS\nC0206: Falla bomba ABS\n[/CODIGOS DE FALLA DYC/ABS]\n\n[PROBLEMAS COMUNES]\nABS No Funciona:\n- Sensor velocidad rueda defectuoso\n- Solenoide ABS defectuoso\n- Bomba ABS no responde\n- Falta continuidad en cableado\n\nPedal Pulsante:\n- Normal durante frenada de emergencia\n- Si ocurre en freno normal: ABS sobre-activo\n\nPedal Suave:\n- Aire en líneas\n- Cilindro maestro defectuoso\n- Fuga de líquido freno\n\nLuz ABS Encendida:\n- Código almacenado: Leer con escáner\n- Típicamente sensor defectuoso\n[/PROBLEMAS COMUNES]"
  }
];

async function loadTransmissionArticles() {
  console.log('Iniciando carga de Transmisión y Suspensión Precisas...');
  console.log(`Total de articulos a insertar: ${transmissionArticles.length}\n`);

  for (const article of transmissionArticles) {
    try {
      const { error } = await supabase
        .from('assistant_kb')
        .insert([
          {
            title: article.title,
            keywords: article.keywords,
            answer: article.answer,
          }
        ]);

      if (error) {
        console.log(`❌ Error al insertar: ${article.title}`, error.message);
      } else {
        console.log(`✅ Insertado: ${article.title}`);
      }
    } catch (err) {
      console.log(`❌ Error: ${err.message}`);
    }
  }

  console.log(`\n✅ Proceso completado - Transmisión y Suspensión`);
  console.log(`Total procesado: ${transmissionArticles.length} articulos`);
}

loadTransmissionArticles();
